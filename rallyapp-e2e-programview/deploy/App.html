<!DOCTYPE html><html><head><title>program-e2e-view</title><script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script><script type="text/javascript">Rally.onReady(function(){Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",itemId:"filter"},{xtype:"container",itemId:"main"}],layout:{type:"vbox",align:"stretch"},launch:function(){console.log("Start of launch function"),this._loadData(!0)},_loadData:function(loadUi){console.log("load data started");Ext.create("Rally.data.wsapi.Store",{model:"User Story",autoLoad:!0,listeners:{load:function(myStore,data,success){global_Count=0;this._onLoad(myStore,data,success)},scope:this},fetch:["FormattedID","Name","ScheduleState","Changesets","Defects","TestRun","LastBuild","PassingTestCaseCount","TestCaseCount","Iteration","Release"]})},_processData:function(myStore,data,loadUi){console.log("loadd data before processing",data);records=_.map(data,function(record){return Ext.apply({DefectDetails:{DefectCount:record.get("Defects").Count,USOBID:record.getId()},Quality:{QualityGate:"Passed",LOC:"4.2K",Duplications:"11.3%"},ChangeSet:{Uri:"https://github3.cisco.com/as-ci-user-gen/spade-cicd-portal",Message:"Loading ...",Author:"jiherage",loaded:!1},TestRun:{Total_Test_Case:record.get("TestCaseCount"),Passed_Test_Case:record.get("PassingTestCaseCount")},IterationRef:null!==record.get("Iteration")?record.get("Iteration")._ref:null,ReleaseRef:null!==record.get("Release")?record.get("Release")._ref:null,USRef:record.get("_ref")},record.getData())}),customData=Ext.create("Rally.data.custom.Store",{data:records});that=this;refreshCount=0;return(loadUi&&this._loadGrid(customData)),customData},_updateChangeset:function(record){var formattedId,loop_cnt=0;comIndex=record.length?(record.length-1):0;while(records.length>loop_cnt){formattedId=records[loop_cnt].FormattedID;if(record[comIndex].data.Message){if(this._isWordPresent(record[comIndex].data.Message,formattedId)){records[loop_cnt].ChangeSet.loaded=!0;records[loop_cnt].ChangeSet.Uri=record[comIndex]?record[comIndex].data.Uri:"https://github3.cisco.com";records[loop_cnt].ChangeSet.Message=record[comIndex]?record[comIndex].data.Message:"Cisco Github Repository";break}}
if(records[loop_cnt].ChangeSet.loaded==!1)records[loop_cnt].ChangeSet.Message="No commits yet";loop_cnt++}
this.myGrid.refresh()},_isWordPresent:function(searchString,searchText){searchText=searchText.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&');return searchString.match(new RegExp("\\b"+searchText+"\\b","i"))!=null},_onLoad:function(myStore,data,success){console.log("loaded data",myStore,data,success);var loadUi=!0;this._processData(myStore,data,loadUi);this._getChangeSets(myStore,data,global_Count);this.myGrid.refresh()},sleep:function(sleep_time){var start=new Date().getTime();var end=start;while(end<start+sleep_time){end=new Date().getTime()}},_getChangeSets:function(myStore,data,global_Count){while(global_Count<data.length)
{story=data[global_Count];if(story.data.Changesets.Count)
{story.getCollection("Changesets").load({fetch:["Uri","Name","CommitTimestamp","Message"],sorters:[{property:"CommitTimestamp",direction:"DSC"}],autoLoad:!0,scope:this,callback:function(record,operation,success){console.log("changesset loaded",records,operation,success);this._updateChangeset(record)}})}
global_Count++}},_loadGrid:function(myStore){this.myGrid=Ext.create("Rally.ui.grid.Grid",{store:myStore,margin:"5 0 0 5",style:{bodyColor:"#000000",borderStyle:"solid",borderWidth:"1px",background:"#efcca0"},bodyStyle:{background:"#ffc",padding:"10px"},plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("<p><b>SCM:</b> {SCM}</p>","<p><b>CI Server:</b> {Ci_Server}</p><br>","<p><b>Quality Server:</b> {QAServer}</p>",{formatChange:function(v){var color=v>=0?"green":"red";return '<span style="color: '+color+';">'+v+"</span>"}})}],columnCfgs:[{xtype:"templatecolumn",text:"ID",dataIndex:"FormattedID",width:50,tpl:Ext.create("Rally.ui.renderer.template.FormattedIDTemplate")},{text:"Name",dataIndex:"Name",width:180,flex:0},{text:"Schedule State",dataIndex:"ScheduleState"},{text:"Latest Commit",dataIndex:"Changesets",width:180,renderer:function(value){var url,commitMsg;if(refreshCount==records.length)refreshCount=0;url=records[refreshCount].ChangeSet.Uri;commitMsg=records[refreshCount].ChangeSet.Message;author=records[refreshCount].ChangeSet.Author;refreshCount++;return Ext.String.format('<div style="padding: 5px; height:120px;color:#000000;border-style:solid;border-width:2px;background:#daedea;" onmouseover="this.style.background=\'white\';" onmouseout="this.style.background=\'#daedea\';"><div><b>Checkin URL:</b> <a href="{0}" target="_blank">Github</a> </div><div> <b>Commit Message:</b> {1} </div><br><div> <b>Author:{2} </b></div> </div>',url,commitMsg,author)}},{text:"Lastest Build",dataIndex:"LastBuild",width:180,renderer:function(value){return console.log(value),Ext.String.format('<div style="align: left; padding: 5px; height:120px;color:#000000;border-style:solid;border-width:2px;background:#daedea" onmouseover="this.style.background=\'white\';" onmouseout="this.style.background=\'#daedea\';"><b>Last Build (<a href="{0}" target="_blank">#9</a>) <br> <br><div style="color:green">Last Stable Build (<a href="{1}" target="_blank">#9</a>)</div> <br><div style="color:red">Last Failed Build (<a href="{2}" target="_blank">#7</a>)</div>  </div>',"https://engci-private-sjc.cisco.com/jenkins/sso-as/job/sandbox/job/spade-portal-webservice/9/console","https://engci-private-sjc.cisco.com/jenkins/sso-as/job/sandbox/job/spade-portal-webservice/9/console","https://engci-private-sjc.cisco.com/jenkins/sso-as/job/sandbox/job/spade-portal-webservice/7/")},tpl:Ext.create("Rally.ui.renderer.template.CardDefectSummaryTemplate")},{text:"Lastest Test Run",dataIndex:"TestRun",width:180,tpl:Ext.create("Rally.ui.renderer.template.CardTestCaseSummaryTemplate"),renderer:function(value){var bkgCol="#daedea",result="Passed";return value.Passed_Test_Case!==value.Total_Test_Case&&(bkgCol="red",result="Failed"),Ext.String.format('<div style="padding: 5px; height:120px;color:#000000;border-style:solid;border-width:2px;background:{4}" onmouseover="this.style.background=\'white\';" onmouseout="this.style.background=\'{4}\';"><b>Status: </b>{2}<br> <b>No of Test Executed:</b> {0} <br> <b>No of Test Passed:<b> {1} <br> <b>No of Test Failed:<b> {3} </div>',value.Total_Test_Case,value.Passed_Test_Case,result,value.Total_Test_Case-value.Passed_Test_Case,bkgCol)}},{text:"Latest Artifacts",dataIndex:"Artifacts",width:180,renderer:function(value){return console.log(value),Ext.String.format('<div style="padding: 5px; height:120px;color:#000000;border-style:solid;border-width:2px;background:#daedea" onmouseover="this.style.background=\'white\';" onmouseout="this.style.background=\'#daedea\';"> <b>Last packaging status:</b> {1} <br> <br> <a href="{0}" target="_blank">Artifactory</a> </div>',"http://engci-maven.cisco.com/artifactory/webapp/#/builds/sandbox%20::%20spade-portal-webservice/5/1483423668598/published/","Passed")}},{text:"Code Quality",dataIndex:"Quality",width:180,renderer:function(value){var bkgCol="#daedea";return "Passed"!==value.QualityGate&&(bkgCol="red"),Ext.String.format('<div style="padding: 5px; height:120px;color:#000000;border-style:solid;border-width:2px;background:{2}" onmouseover="this.style.background=\'white\';" onmouseout="this.style.background=\'{2}\';"> <b>Quality gate:</b> {0}, <br><b>Lines of Code:</b> {1}  <br> <b>Duplication:</b> {3} <br><br> <a href="{4}" target="_blank">For details click here</a></div>',value.QualityGate,value.LOC,bkgCol,value.Duplications,"https://engci-sonar-blr.cisco.com/sonar/overview?id=as-spade-portal-webservice")}},{text:"Open Defects",width:180,dataIndex:"DefectDetails",renderer:function(value){var bkgCol="#daedea";return 0!==value.DefectCount&&(bkgCol="red"),Ext.String.format('<div style="padding: 5px; height:120px;color:#000000;border-style:solid;border-width:2px;background:{1}" onmouseover="this.style.background=\'white\';" onmouseout="this.style.background=\'{1}\';">Open Defects: {0}<br> <br> <a href="{2}" target="_blank">Click Here for Details</a></div>',value.DefectCount,bkgCol,"https://rally1.rallydev.com/#/60911267918d/detail/userstory/"+value.USOBID+"/defects")}}]}),this.UserStoryState={xtype:"rallyfieldvaluecombobox",flex:0,padding:5,model:"UserStory",field:"ScheduleState",style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px"},listeners:{select:function(combobox,records){console.log(combobox,records);var store=this.myGrid.getStore();store.clearFilter(!0),store.filter({property:"ScheduleState",operator:"=",value:this.down("rallyfieldvaluecombobox").getValue(),root:"data"}),this.myGrid.refresh()},scope:this}},this.relaseCombo={xtype:"rallyreleasecombobox",padding:5,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px",marginLef:"10px"},listeners:{select:function(combobox,records){console.log(combobox,records);var store=this.myGrid.getStore();store.clearFilter(!0),store.filter({property:"ReleaseRef",operator:"=",value:this.down("rallyreleasecombobox").getValue(),root:"data"}),this.myGrid.refresh()},scope:this}},this.iteCombo={xtype:"rallyiterationcombobox",padding:5,style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px",marginLef:"10px"},listeners:{select:function(combobox,records){console.log("selected",combobox,records);var store=this.myGrid.getStore();store.clearFilter(!0),store.filter({property:"IterationRef",operator:"=",value:this.down("rallyiterationcombobox").getValue(),root:"data"}),this.myGrid.refresh()},scope:this}},this.artifactSearchCombo={xtype:"rallyartifactsearchcombobox",padding:5,storeConfig:{models:["userstory"]},style:{borderColor:"#000000",borderStyle:"solid",borderWidth:"1px",marginLef:"10px"},sorters:[{property:"FormattedID",direction:"ASC"}],listeners:{select:function(combobox,records){console.log("selected",combobox,records[0].data._ref);var store=this.myGrid.getStore();store.clearFilter(!0),store.filter({property:"USRef",operator:"=",value:this.down("rallyartifactsearchcombobox").getValue(),root:"data"}),this.myGrid.refresh()},scope:this}};var filterContainer=Ext.create("Ext.container.Container",{layout:{type:"hbox",align:"stretch"},frame:!0,margin:"5 0 0 5",height:"50px",title:"Filters",style:{bodyColor:"#000000",borderStyle:"solid",borderWidth:"1px",background:"#ede3d7"},items:[this.relaseCombo,this.iteCombo,this.UserStoryState,this.artifactSearchCombo]});this.down("#filter").add(filterContainer),this.down("#main").add(this.myGrid)}});Rally.launchApp('CustomApp',{name:"program-e2e-view",parentRepos:""})});</script><style type="text/css"></style></head><body></body></html>
